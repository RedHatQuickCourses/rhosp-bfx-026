<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Guided solution (page 2) :: RHOSP Networking Break-Fix Practice - Resolving &#x27;No Route to Host&#x27; and &#x27;Destination Host Unreachable&#x27; for SSH</title>
    <link rel="prev" href="section1.html">
    <link rel="next" href="section3.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">RHOSP Networking Break-Fix Practice - Resolving &#x27;No Route to Host&#x27; and &#x27;Destination Host Unreachable&#x27; for SSH</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rhosp-bfx-026" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">RHOSP Networking Break-Fix Practice - Resolving &#x27;No Route to Host&#x27; and &#x27;Destination Host Unreachable&#x27; for SSH</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Red Hat OpenStack Platform: Break-fix Practice - 1</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter1/index.html">Whatâ€™s in this break-fix?</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section1.html">Break-fix activity</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section2.html">Check your work</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section3.html">Break-fix Scenario</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Guided solution</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section1.html">Guided solution (page 1)</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="section2.html">Guided solution (page 2)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section3.html">Evalution</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/appendix.html">Appendix</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">RHOSP Networking Break-Fix Practice - Resolving &#x27;No Route to Host&#x27; and &#x27;Destination Host Unreachable&#x27; for SSH</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">RHOSP Networking Break-Fix Practice - Resolving 'No Route to Host' and 'Destination Host Unreachable' for SSH</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">RHOSP Networking Break-Fix Practice - Resolving 'No Route to Host' and 'Destination Host Unreachable' for SSH</a></li>
    <li><a href="index.html">Guided solution</a></li>
    <li><a href="section2.html">Guided solution (page 2)</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Guided solution (page 2)</h1>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Capture ARP request packets using <strong>tcpdump</strong> on <strong>compute</strong> node.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">tcpdump -i eth2 arp -c1 -w arp-request.pcap</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>[root@compute01 ~]# tcpdump -i eth2 arp -c1 -w arp-request.pcap
dropped privs to tcpdump
tcpdump: listening on eth2, link-type EN10MB (Ethernet), capture size 262144 bytes
1 packet captured
1 packet received by filter
0 packets dropped by kernel</pre>
</div>
</div>
<div class="paragraph">
<p>Before running the above command, ensure to <strong>ping the floating IP</strong> from another terminal <strong>from workstation vm</strong> to generate the necessary packets.</p>
</div>
</li>
<li>
<p>Check if the captured packets are ARP requests for the floating IP.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">tcpdump -r arp-request.pcap</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>[root@compute01 ~]# tcpdump -r arp-request.pcap
reading from file arp-request.pcap, link-type EN10MB (Ethernet), snapshot length 262144
dropped privs to tcpdump
06:12:38.696143 ARP, Request who-has 192.168.51.98 tell _gateway, length 28
[root@compute01 ~]#</pre>
</div>
</div>
</li>
<li>
<p>Run below command on the <strong>compute</strong> node to identify the OpenFlow protocol number for network interface eth2.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ovs-ofctl show br-ex</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>[root@compute01 ~]# ovs-ofctl show br-ex
OFPT_FEATURES_REPLY (xid=0x2): dpid:000052540002331f
n_tables:254, n_buffers:0
capabilities: FLOW_STATS TABLE_STATS PORT_STATS QUEUE_STATS ARP_MATCH_IP
actions: output enqueue set_vlan_vid set_vlan_pcp strip_vlan mod_dl_src mod_dl_dst mod_nw_src mod_nw_dst mod_nw_tos mod_tp_src mod_tp_dst
 1(eth2): addr:52:54:00:02:33:1f
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max
 LOCAL(br-ex): addr:52:54:00:02:33:1f
     config:     0
     state:      0
     speed: 0 Mbps now, 0 Mbps max
OFPT_GET_CONFIG_REPLY (xid=0x4): frags=normal miss_send_len=0
[root@compute01 ~]#</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>eth2 is associated with port number 1</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>On the <strong>compute</strong> node, perform the OpenFlow protocol trace on <strong>br-ex</strong> with in_port set to 1.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ovs-appctl ofproto/trace br-ex in_port=1 $(ovs-pcap arp-request.pcap)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ovs-pcap</strong> command is provided by <strong>openvswitch-test</strong> package.</p>
</li>
<li>
<p>openvswitch-test package is available form the <strong>fast-datapath-for-rhel-9-x86_64-rpms</strong> channel.</p>
</li>
<li>
<p>Subscribe the compute node and enable fast-datapath-for-rhel-9-x86_64-rpms channel.</p>
</li>
<li>
<p>Install <strong>openvswitch3.3-test-3.3.0-49.el9fdp.noarch</strong> package.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">subscription-manager register
subscription-manager repos --enable=fast-datapath-for-rhel-9-x86_64-rpms
dnf install openvswitch3.3-test-3.3.0-49.el9fdp.noarch</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>[root@compute01 ~]# ovs-appctl ofproto/trace br-ex in_port=1 $(ovs-pcap arp-request.pcap)
-bash: ovs-pcap: command not found
Flow: in_port=1,vlan_tci=0x0000,dl_src=00:00:00:00:00:00,dl_dst=00:00:00:00:00:00,dl_type=0x0000

bridge("br-ex")
---------------
 0. priority 0
    NORMAL
     -&gt; no learned MAC for destination, flooding

Final flow: unchanged
Megaflow: recirc_id=0,eth,in_port=1,dl_src=00:00:00:00:00:00,dl_dst=00:00:00:00:00:00,dl_type=0x0000
Datapath actions: 3
[root@compute01 ~]#</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>The trace shows that the ARP request is flooding, and "Datapath actions: 3" indicates that it was delivered to br-ex (see output of below command).</p>
<div class="listingblock">
<div class="content">
<pre>[root@compute01 ~]# ovs-dpctl show
system@ovs-system:
  lookups: hit:5562620 missed:182693 lost:0
  flows: 27
  masks: hit:11191975 total:5 hit/pkt:1.95
  cache: hit:2462172 hit-rate:42.86%
  caches:
    masks-cache: size:256
  port 0: ovs-system (internal)
  port 1: genev_sys_6081 (geneve: packet_type=ptap)
  port 2: br-int (internal)
  port 3: br-ex (internal)
  port 4: br-osp (internal)
  port 5: eth2
  port 6: eth3
  port 7: vlan20 (internal)
  port 8: vlan21 (internal)
  port 9: vlan22 (internal)
  port 10: tapd2db5833-99
  port 11: tap96cd71b0-20
[root@compute01 ~]#</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>"Data path 3" means the traffic was delivered to br-ex, which is a port 3 on the br-ex bridge.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Run tcpdump on br-exon the <strong>compute</strong> node.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">tcpdump -envvi br-ex arp</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>[root@compute01 ~]# tcpdump -envvi br-ex arp
dropped privs to tcpdump
tcpdump: listening on br-ex, link-type EN10MB (Ethernet), snapshot length 262144 bytes
08:12:19.474463 52:54:00:02:33:fe &gt; Broadcast, ethertype ARP (0x0806), length 42: Ethernet (len 6), IPv4 (len 4), Request who-has 192.168.51.98 tell 192.168.51.254, length 28
08:12:20.521301 52:54:00:02:33:fe &gt; Broadcast, ethertype ARP (0x0806), length 42: Ethernet (len 6), IPv4 (len 4), Request who-has 192.168.51.98 tell 192.168.51.254, length 28
08:12:21.545346 52:54:00:02:33:fe &gt; Broadcast, ethertype ARP (0x0806), length 42: Ethernet (len 6), IPv4 (len 4), Request who-has 192.168.51.98 tell 192.168.51.254, length 28</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The output shows ARP requests, indicating that the traffic is indeed being received by the br-ex port.</p>
</li>
<li>
<p>However, the issue lies in why this traffic is not making its way to br-int, which is crucial for proper network routing.</p>
</li>
<li>
<p>There is a floating IP configured on a particular compute node.</p>
</li>
<li>
<p>OVN (Open Virtual Network) is aware of this configuration.</p>
</li>
<li>
<p>OVN creates a patch port between the provider network and br-int. * Importantly, each provider network has its own patch port connecting br-ex and br-int.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Review at the ovs-vsctl show output captured earlier, br-ex has only one port - eth2, which is the NIC (Network Interface Card) of the compute node.</p>
<div class="listingblock">
<div class="content">
<pre>[root@compute01 ~]# ovs-vsctl show
. . .
    Bridge br-ex
        fail_mode: standalone
        Port br-ex
            Interface br-ex
                type: internal
        Port eth2
            Interface eth2
. . .</pre>
</div>
</div>
<div class="paragraph">
<p>The key issue here is the absence of a patch port between br-int and br-ex. This missing link prevents traffic from flowing properly between the internal network (br-int) and the external network (br-ex).</p>
</div>
</li>
<li>
<p>Now let us examine your OVN bridge mappings. Run the below command on the <strong>compute</strong> node.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ovs-vsctl list open .</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>[root@compute01 ~]# ovs-vsctl list open .
_uuid               : f40f8bed-c407-4a8e-82c6-5e2b609bd143
bridges             : [0964364a-dc77-4dcc-8e8d-5889c53e6749, 39832bfb-915c-41be-9ebd-22bf04fb17dd, b02d474e-5d5c-41e2-ad77-976d7b4c44d2]
cur_cfg             : 39
datapath_types      : [netdev, system]
datapaths           : {system=5663d999-85b5-475f-b893-6916270b4b68}
db_version          : "8.5.0"
dpdk_initialized    : false
dpdk_version        : "DPDK 23.11.2"
external_ids        : {hostname=compute01.srv.example.com, ovn-bridge=br-int, ovn-chassis-mac-mappings="datacentre:0e:0a:38:8e:8e:08", ovn-encap-ip="172.19.0.110", ovn-encap-tos="0", ovn-encap-type=geneve, ovn-match-northd-version=False, ovn-monitor-all=True, ovn-ofctrl-wait-before-clear="8000", ovn-remote="ssl:ovsdbserver-sb.openstack.svc:6642", ovn-remote-probe-interval="60000", rundir="/var/run/openvswitch", system-id="6b475747-b459-4488-b670-91252b56d663"}
iface_types         : [bareudp, erspan, geneve, gre, gtpu, internal, ip6erspan, ip6gre, lisp, patch, srv6, stt, system, tap, vxlan]
manager_options     : [241be795-53a8-4fef-be2a-667d77558060]
next_cfg            : 39
other_config        : {ovn-chassis-idx-6b475747-b459-4488-b670-91252b56d663="", vlan-limit="0"}
ovs_version         : "3.3.4-62.el9fdp"
ssl                 : []
statistics          : {}
system_type         : rhel
system_version      : "9.4"
[root@compute01 ~]#</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Bridge mappings are important for determining which provider network corresponds to a specific bridge.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>This output shows the OVN setup, including bridges, data paths, and various configurations. Bridge mapping is stored in external_ids.</p>
<div class="listingblock">
<div class="content">
<pre>external_ids        : {hostname=compute01.srv.example.com, ovn-bridge=br-int, ovn-chassis-mac-mappings="datacentre:0e:0a:38:8e:8e:08", ovn-encap-ip="172.19.0.110", ovn-encap-tos="0", ovn-encap-type=geneve, ovn-match-northd-version=False, ovn-monitor-all=True, ovn-ofctrl-wait-before-clear="8000", ovn-remote="ssl:ovsdbserver-sb.openstack.svc:6642", ovn-remote-probe-interval="60000", rundir="/var/run/openvswitch", system-id="6b475747-b459-4488-b670-91252b56d663"}
iface_types         : [bareudp, erspan, geneve, gre, gtpu, internal, ip6erspan, ip6gre, lisp, patch, srv6, stt, system, tap, vxlan]</pre>
</div>
</div>
<div class="paragraph">
<p>Notably, it lacks information about bridge mappings. Bridge mappings play an important role in associating a NIC with a provider network (commonly referred to as a datacenter network). In this case OVN does not know which provider network is the datacenter because it needs to map between the NIC and the provider network. To create this connection, we need to inform OVN about the relationship between the NIC and the provider network, typically named 'datacenter'.</p>
</div>
</li>
<li>
<p>Explore public network details from the <strong>workstation</strong> vm.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc exec -n openstack openstackclient -- openstack network show public</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>[student@workstation ~]$ oc exec -n openstack openstackclient -- openstack network show public
+---------------------------+--------------------------------------+
| Field                     | Value                                |
+---------------------------+--------------------------------------+
| admin_state_up            | UP                                   |
| availability_zone_hints   |                                      |
| availability_zones        |                                      |
| created_at                | 2025-05-04T21:29:27Z                 |
| description               |                                      |
| dns_domain                |                                      |
| id                        | 5526bfcf-a164-4a91-ad99-90bb5c41f500 |
| ipv4_address_scope        | None                                 |
| ipv6_address_scope        | None                                 |
| is_default                | False                                |
| is_vlan_transparent       | None                                 |
| l2_adjacency              | True                                 |
| mtu                       | 1500                                 |
| name                      | public                               |
| port_security_enabled     | True                                 |
| project_id                | d388b58059514443a8dced8c2ed691f6     |
| provider:network_type     | flat                                 |
| provider:physical_network | datacentre                           |
| provider:segmentation_id  | None                                 |
| qos_policy_id             | None                                 |
| revision_number           | 2                                    |
| router:external           | External                             |
| segments                  | None                                 |
| shared                    | False                                |
| status                    | ACTIVE                               |
| subnets                   | b5a9f748-df82-436a-b8e3-14912e258b5d |
| tags                      |                                      |
| tenant_id                 | d388b58059514443a8dced8c2ed691f6     |
| updated_at                | 2025-05-04T21:29:35Z                 |
+---------------------------+--------------------------------------+
[student@workstation ~]$</pre>
</div>
</div>
<div class="paragraph">
<p>In this output, find information about the "public" network, including its physical network, which is labeled as <strong>datacentre</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>| provider:physical_network | datacentre</pre>
</div>
</div>
<div class="paragraph">
<p>This is essentially a placeholder name that we define in configuration files. We need to specify which NIC on the compute nodes corresponds to this "datacenter" network.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The issue at hand is that OVN does not inherently know that the <strong>br-ex</strong> bridge represents the <strong>datacenter provider network</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To establish this link, we must explicitly configure OVN bridge mappings. This configuration ensures that OVN associates br-ex with the datacenter network.</p>
</div>
</li>
<li>
<p>Configure the OVN bridge mapping settings using the ovs-vsctl set command on the <strong>compute</strong> node.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ovs-vsctl set open . external_ids:ovn-bridge-mappings=datacentre:br-ex</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>[root@compute01 ~]# ovs-vsctl set open . external_ids:ovn-bridge-mappings=datacentre:br-ex</pre>
</div>
</div>
</li>
<li>
<p>Re-run the ovs-vsctl show command on the <strong>compute</strong> node to verify that a patch port has been created between br-int and br-ex.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ovs-vsctl show</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>[root@compute01 ~]# ovs-vsctl show
. . .
    Bridge br-ex
        fail_mode: standalone
        Port br-ex
            Interface br-ex
                type: internal
        Port eth2
            Interface

        Port patch-provnet-392f50ef-731c-4984-916d-9ce45906ace1-to-br-int
            Interface patch-provnet-392f50ef-731c-4984-916d-9ce45906ace1-to-br-int
                type: patch
                options: {peer=patch-br-int-to-provnet-392f50ef-731c-4984-916d-9ce45906ace1}
    Bridge br-int
        fail_mode: secure
        datapath_type: system
. . .
        Port patch-br-int-to-provnet-392f50ef-731c-4984-916d-9ce45906ace1
            Interface patch-br-int-to-provnet-392f50ef-731c-4984-916d-9ce45906ace1
                type: patch
                options: {peer=patch-provnet-392f50ef-731c-4984-916d-9ce45906ace1-to-br-int}
. . .</pre>
</div>
</div>
<div class="paragraph">
<p>This connection is crucial for proper network communication. By addressing this missing link, we can ensure that traffic flows smoothly between the internal and external networks, thus resolving the connectivity issue we encountered.</p>
</div>
</li>
</ol>
</div>
<nav class="pagination">
  <span class="prev"><a href="section1.html">Guided solution (page 1)</a></span>
  <span class="next"><a href="section3.html">Evalution</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
