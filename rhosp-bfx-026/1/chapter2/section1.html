<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Guided solution (page 1) :: Troubleshooting instance connectivity issue in Red Hat OpenStack Platform 18</title>
    <link rel="prev" href="index.html">
    <link rel="next" href="section2.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Troubleshooting instance connectivity issue in Red Hat OpenStack Platform 18</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rhosp-bfx-026" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Troubleshooting instance connectivity issue in Red Hat OpenStack Platform 18</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Troubleshooting instance connectivity issue in Red Hat OpenStack Platform 18</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter1/index.html">Whatâ€™s in this break-fix?</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section1.html">Break-fix activity</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section2.html">Check your work</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section3.html">Break-fix Scenario</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Guided solution</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="section1.html">Guided solution (page 1)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section2.html">Guided solution (page 2)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section3.html">Evalution</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/appendix.html">Appendix</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Troubleshooting instance connectivity issue in Red Hat OpenStack Platform 18</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Troubleshooting instance connectivity issue in Red Hat OpenStack Platform 18</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Troubleshooting instance connectivity issue in Red Hat OpenStack Platform 18</a></li>
    <li><a href="index.html">Guided solution</a></li>
    <li><a href="section1.html">Guided solution (page 1)</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Guided solution (page 1)</h1>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to your lab environment on the <strong>ROLE</strong> platform.</p>
</li>
<li>
<p>Break the environment if you have not done it and then step through the fix.</p>
<div class="paragraph">
<p>As the <strong>student</strong> user, run the lab start script on the <strong>workstation</strong> VM to reproduce the issue.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /home/student/osp_training/scenarios_repo/
./lab start bfx026</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>[student@workstation scenarios_repo]$ ./lab start bfx026
Running start action against scenario bfx026
[WARNING]: Invalid characters were found in group names but not replaced, use
-vvvv to see details
Run the following command:
ssh -i /tmp/scenario-bfx026-key.pem cirros@192.168.51.98</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The IP address in the displayed output may differ in your case.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Run the ssh command from the previous lab command output and notice the Connection timed out error. Also run the ping command against instance IP.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ssh -i /home/student/osp_training/.scenariobfx026/scenario-bfx026-key.pem cirros@instance.ip.in.your.lab</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ping instance.ip.in.your.lab -c 1</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
In the above commands <strong>replace</strong> the string <strong>instance.ip.in.your.lab</strong> with the <strong>actual IP</strong> address displayed in the output of the lab start script.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>[student@workstation ~]$ ssh -i /tmp/scenario-bfx026-key.pem cirros@192.168.51.98
ssh: connect to host 192.168.51.98 port 22: No route to host
[student@workstation ~]$
[student@workstation ~]$ ping 192.168.51.98 -c 1
PING 192.168.51.98 (192.168.51.98) 56(84) bytes of data.
From 172.25.250.253 icmp_seq=1 Destination Host Unreachable

--- 192.168.51.98 ping statistics ---
1 packets transmitted, 0 received, +1 errors, 100% packet loss, time 0ms

[student@workstation ~]$</pre>
</div>
</div>
<div class="paragraph">
<p><strong>You observe that both ping and ssh attempts failed which indicates lack of connectivity.</strong></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only the utility server has configured IP address which belongs to the same Layer 2 (L2) domain as the Floating IP associated to the VM.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Establish an SSH connection to the utility VM, then verify ping connectivity and ARP resolution from there.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ssh lab@utility</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ping 192.168.51.98 -c 1</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>[student@workstation ~]$ ssh lab@utility
Register this system with Red Hat Insights: insights-client --register
Create an account or view all your systems at https://red.ht/insights-dashboard
Last login: Tue Jun 17 02:02:33 2025 from 172.25.250.9
[lab@utility ~]$
[lab@utility ~]$ ping 192.168.51.98 -c 1
PING 192.168.51.98 (192.168.51.98) 56(84) bytes of data.
From 192.168.51.254 icmp_seq=1 Destination Host Unreachable

--- 192.168.51.98 ping statistics ---
1 packets transmitted, 0 received, +1 errors, 100% packet loss, time 0ms</pre>
</div>
</div>
</li>
<li>
<p>Because the ping test failed, it is essential to double-check with ARP.</p>
</li>
<li>
<p>Only the <strong>utility</strong> server has L2 access to the OSP External Network, hence you have to check ARP on that server.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ip neighbour | grep 192.168.51.98</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>[root@utility ~]# ip neighbour | grep 192.168.51.98
192.168.51.98 dev eth2 FAILED</pre>
</div>
</div>
</li>
<li>
<p>Identify the network interface on the <strong>utility</strong> vm which is in the same IP address range as that of OSP External network.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ip address</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>. . .
4: eth2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 52:54:00:02:33:fe brd ff:ff:ff:ff:ff:ff
    altname enp0s5
    altname ens5
    inet 192.168.51.254/24 brd 192.168.51.255 scope global noprefixroute eth2
       valid_lft forever preferred_lft forever
    inet6 fe80::ae34:5b6d:c0af:8a10/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
. . .</pre>
</div>
</div>
</li>
<li>
<p>Run tcpdump on <strong>utility</strong> vm in one terminal and open a new terminal and ping the IP of the instance from <strong>wokstation</strong></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo tcpdump -envvi eth2 arp</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output terminal 1</div>
<div class="content">
<pre>[lab@utility ~]$ sudo tcpdump -envvi eth2 arp
dropped privs to tcpdump
tcpdump: listening on eth2, link-type EN10MB (Ethernet), snapshot length 262144 bytes
03:51:55.835096 52:54:00:02:33:fe &gt; Broadcast, ethertype ARP (0x0806), length 42: Ethernet (len 6), IPv4 (len 4), Request who-has 192.168.51.98 tell 192.168.51.254, length 28
03:51:56.841041 52:54:00:02:33:fe &gt; Broadcast, ethertype ARP (0x0806), length 42: Ethernet (len 6), IPv4 (len 4), Request who-has 192.168.51.98 tell 192.168.51.254, length 28
03:51:57.865025 52:54:00:02:33:fe &gt; Broadcast, ethertype ARP (0x0806), length 42: Ethernet (len 6), IPv4 (len 4), Request who-has 192.168.51.98 tell 192.168.51.254, length 28</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output terminal 2</div>
<div class="content">
<pre>[lab@utility ~]$ ping 192.168.51.98 -c 3
PING 192.168.51.98 (192.168.51.98) 56(84) bytes of data.
From 192.168.51.254 icmp_seq=1 Destination Host Unreachable
From 192.168.51.254 icmp_seq=2 Destination Host Unreachable
From 192.168.51.254 icmp_seq=3 Destination Host Unreachable

--- 192.168.51.98 ping statistics ---
3 packets transmitted, 0 received, +3 errors, 100% packet loss, time 2030ms</pre>
</div>
</div>
<div class="paragraph">
<p><strong>You observe that ARP requests are being sent, but no responses are being received.</strong></p>
</div>
</li>
<li>
<p>On the <strong>workstation</strong> vm use the openstackclient pod and check where the VM is running.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc exec -n openstack openstackclient -- openstack server list --long -c Name -c Status -c Host</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>[student@workstation ~]$ oc exec -n openstack openstackclient -- openstack server list --long -c Name -c Status -c Host
+--------------------+--------+---------------------------+
| Name               | Status | Host                      |
+--------------------+--------+---------------------------+
| scenario-bfx026-vm | ACTIVE | compute01.srv.example.com |
+--------------------+--------+---------------------------+
[student@workstation ~]$</pre>
</div>
</div>
<div class="paragraph">
<p><strong>In the above output you observe that it is compute01.srv.example.com. This may vary in your case</strong></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The RHOSP cluster is configured to operate with Distributed Virtual Routing (DVR) functionality. As the DVR is enabled, all Floating IPs are treated as DVR, directing traffic directly to the compute node&#8217;s br-ex interface. This arrangement ensures that traffic bound for the floating IP bypasses the control node entirely.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Login to the <strong>compute</strong> node where instance is running and run <strong>ovs-vsctl show</strong> command.</p>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>[student@workstation ~]$ ssh root@compute01.srv.example.com
Activate the web console with: systemctl enable --now cockpit.socket

Register this system with Red Hat Insights: insights-client --register
Create an account or view all your systems at https://red.ht/insights-dashboard
Last login: Tue Jun 17 10:48:42 2025 from 192.168.51.254
[root@compute01 ~]#
[root@compute01 ~]# ovs-vsctl show
. . .
    Bridge br-ex
        fail_mode: standalone
        Port br-ex
            Interface br-ex
                type: internal
        Port eth2
            Interface eth2
. . .</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Identify the network interface used under external bridge br-ex.</strong></p>
</div>
</li>
<li>
<p>Verify the ARP requests on the Ethernet device eth2 used under br-ex.</p>
<div class="paragraph">
<p><strong>Run tcpdump on the compute node</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">tcpdump -envvi eth2 arp</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Run ping from the utility vm</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ping IP -c 3</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Replace IP with appropriate string</strong></p>
</div>
<div class="listingblock">
<div class="title">Sample output terminal 1</div>
<div class="content">
<pre>[root@compute01 ~]# tcpdump -envvi eth2 arp
dropped privs to tcpdump
tcpdump: listening on eth2, link-type EN10MB (Ethernet), snapshot length 262144 bytes
08:03:47.363832 52:54:00:02:33:fe &gt; Broadcast, ethertype ARP (0x0806), length 42: Ethernet (len 6), IPv4 (len 4), Request who-has 192.168.51.98 tell 192.168.51.254, length 28
08:03:48.394094 52:54:00:02:33:fe &gt; Broadcast, ethertype ARP (0x0806), length 42: Ethernet (len 6), IPv4 (len 4), Request who-has 192.168.51.98 tell 192.168.51.254, length 28
08:03:49.418039 52:54:00:02:33:fe &gt; Broadcast, ethertype ARP (0x0806), length 42: Ethernet (len 6), IPv4 (len 4), Request who-has 192.168.51.98 tell 192.168.51.254, length 28</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output terminal 2</div>
<div class="content">
<pre>[lab@utility ~]$ ping 192.168.51.98 -c 3
PING 192.168.51.98 (192.168.51.98) 56(84) bytes of data.
From 192.168.51.254 icmp_seq=1 Destination Host Unreachable
From 192.168.51.254 icmp_seq=2 Destination Host Unreachable
From 192.168.51.254 icmp_seq=3 Destination Host Unreachable

--- 192.168.51.98 ping statistics ---
3 packets transmitted, 0 received, +3 errors, 100% packet loss, time 2055ms</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>ARP requests are being sent but not replied.</p>
</li>
<li>
<p>These should be answered by the router gateway port.</p>
</li>
<li>
<p>The next step is to verify the connectivity from the Metadata namespace by attempting to ping the instance with its fixed IP.</p>
</li>
</ul>
</div>
</li>
<li>
<p>List the floating IP and ensure its alignment with the fixed IP address.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc exec -n openstack openstackclient -- openstack floating ip list</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>[student@workstation ~]$ oc exec -n openstack openstackclient -- openstack floating ip list
+--------------------------------------+---------------------+------------------+--------------------------------------+--------------------------------------+----------------------------------+
| ID                                   | Floating IP Address | Fixed IP Address | Port                                 | Floating Network                     | Project                          |
+--------------------------------------+---------------------+------------------+--------------------------------------+--------------------------------------+----------------------------------+
| 13261cca-3b7a-4229-9c63-aa3d49a0c110 | 192.168.51.98       | 192.168.190.127  | d2db5833-99bd-4de0-a7ca-bf8c1321882c | 5526bfcf-a164-4a91-ad99-90bb5c41f500 | d388b58059514443a8dced8c2ed691f6 |
+--------------------------------------+---------------------+------------------+--------------------------------------+--------------------------------------+----------------------------------+
[student@workstation ~]$</pre>
</div>
</div>
</li>
<li>
<p>Connect to the metadata namespace and ping to instance&#8217;s fixed IP address from there.</p>
</li>
<li>
<p>Run the following command on the <strong>compute</strong> node.</p>
<div class="listingblock">
<div class="content">
<pre>ip netns
ip netns exec &lt;namespace&gt; ping &lt;fixed ip of instance&gt; -c 1</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Replace &lt;namespace&gt; and &lt;fixed ip of instance&gt; with the appropriate string from the previous output.</strong></p>
</div>
<div class="listingblock">
<div class="title">Sample output</div>
<div class="content">
<pre>[root@compute01 ~]# ip netns
ovnmeta-96cd71b0-2988-43ca-bfd3-b3a9ddc59d51 (id: 0)
[root@compute01 ~]#
[root@compute01 ~]# ip netns exec ovnmeta-96cd71b0-2988-43ca-bfd3-b3a9ddc59d51 ping 192.168.190.127 -c 1
PING 192.168.190.127 (192.168.190.127) 56(84) bytes of data.
64 bytes from 192.168.190.127: icmp_seq=1 ttl=64 time=0.543 ms

--- 192.168.190.127 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 0.543/0.543/0.543/0.000 ms
[root@compute01 ~]#</pre>
</div>
</div>
<div class="paragraph">
<p><strong>If you receive a response, it indicates that the VM&#8217;s local network is functioning properly.</strong></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Connectivity works for ICMP from the namespace, which is local to the compute node, but it does not work from the outside. We can try running the OpenFlow protocol trace.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">Guided solution</a></span>
  <span class="next"><a href="section2.html">Guided solution (page 2)</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
